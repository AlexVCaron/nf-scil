name: Lint nf-scil component

on:
  workflow_dispatch:
    inputs:
      component:
        description: "A tag describing the component"
        required: true
        type: string
      type:
        description: "Type of component"
        required: true
        type: choice
        options:
          - module
          - subworkflow
      nextflow_version:
        description: "Nextflow version to use"
        required: false
        type: string
        default: "24.04.4"
      nf_core_version:
        description: "nf-core version to use"
        required: false
        type: string
        default: "2.14.*"
  workflow_call:
    inputs:
      component:
        description: "A tag describing the component"
        required: true
        type: string
      type:
        description: "Type of component"
        required: true
        type: string
      nextflow_version:
        description: "Nextflow version to use"
        required: false
        type: string
        default: "24.04.4"
      nf_core_version:
        description: "nf-core version to use"
        required: false
        type: string
        default: "2.14.*"

run-name: Lint ${{ inputs.component }}
jobs:
  nf-core-lint:
    runs-on: ubuntu-latest
    name: lint - ${{ inputs.component }}

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: 'pip'
      - uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: "17"
          cache: 'gradle'
      - uses: nf-core/setup-nextflow@v2
        with:
          version: ${{ inputs.nextflow_version }}

      - name: Upgrade pip
        run: python -m pip install --upgrade pip

      - name: Install nf-core tools
        run: |
          python -m pip install --upgrade --force-reinstall nf-core==${{ inputs.nf_core_version }}

      - name: Lint ${{ inputs.type }} ${{ inputs.component }}
        env:
          GIT_CLONE_PROTECTION_ACTIVE: false
        run: |
          nf-core --verbose ${{ inputs.type }}s \
            --git-remote https://github.com/${{ github.repository }}.git \
            --branch ${GITHUB_HEAD_REF:-${GITHUB_REF#refs/heads/}}
            lint ${{ inputs.component }}
